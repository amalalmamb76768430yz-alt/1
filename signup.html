<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<title>Sign Up</title>

<!-- (كل الستايل كما هو بدون أي تغيير) -->
<style>
/* نفس الستايل تبعك بالكامل */
</style>
</head>

<body>
<div class="page">
  <!-- ===== نفس المحتوى تبعك بدون تغيير ===== -->
</div>

<!-- ================= SCRIPTS ================= -->

<!-- 1️⃣ Supabase config -->
<script src="sb-config.js"></script>

<!-- 2️⃣ Auth logic -->
<script src="auth.js"></script>

<!-- 3️⃣ Page logic -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  const phoneInput = document.getElementById("phone-input");
  const passwordInput = document.getElementById("password-input");
  const confirmPasswordInput = document.getElementById("confirm-password-input");
  const invitationInput = document.getElementById("invitation-code-input");
  const signUpBtn = document.querySelector(".sign-up-btn");
  const codeInput = document.getElementById("verification-code-input");

  function showToast(msg) {
    const toast = document.getElementById("form-toast");
    toast.textContent = msg;
    toast.classList.add("toast-visible");
    setTimeout(() => toast.classList.remove("toast-visible"), 2500);
  }

  signUpBtn.addEventListener("click", async function () {
    const phone = phoneInput.value.trim();
    const pass = passwordInput.value;
    const confirm = confirmPasswordInput.value;
    const invite = invitationInput.value.trim();
    const code = codeInput.value.trim();

    if (!phone!confirm || !invite)
      return showToast("Please fill all fields");

    if (pass.length < 8)
      return showToast("Password must be at least 8 characters");

    if (pass !== confirm)
      return showToast("Passwords do not match");

    if (!window.ExaAuth || !window.ExaAuth.registerWithInvite)
      return showToast("Auth service not loaded");

    try {
      const result = await window.ExaAuth.registerWithInvite({
        phone,
        usedInviteCode: invite
      });

      localStorage.setItem("currentUserId", result.user_id);

      window.location.href = "my-assets.html";

    } catch (e) {
      showToast(e.message || "Registration failed");
    }
  });
});
</script>

</body>
</html>